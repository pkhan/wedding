var App,animateLayer,makeLayer,personSection,extend=function(t,e){for(var n in e){if(hasProp.call(e,n))t[n]=e[n]}function r(){this.constructor=t}r.prototype=e.prototype;t.prototype=new r;t.__super__=e.prototype;return t},hasProp={}.hasOwnProperty;makeLayer=function(t){var e;e=$("<div></div>").addClass("heart-bg").css({"background-size":t+"px "+t+"px"});return{$el:e,heartHeight:t}};animateLayer=function(t,e){var n;n=2e3-e;return setTimeout(function(){return t.$el.animate({top:"-"+t.height+"px"},{duration:n,easing:"linear",complete:function(e){return function(){return t.$el.remove()}}(this)})},e)};$.fn.animateHearts=function(t,e,n,r,i){var o,s,a,u,p,l,h,c,d,f;if(t==null){t=3}if(e==null){e=2e3}if(n==null){n=2}if(r==null){r=20}if(i==null){i=300}s=this.height();u=s*n;c=function(){var e,n,i;i=[];for(a=e=1,n=t;1<=n?e<=n:e>=n;a=1<=n?++e:--e){i.push(makeLayer(r*a))}return i}();o=0;f=[];for(p=0,d=c.length;p<d;p++){l=c[p];h=Math.round(u/l.heartHeight)*l.heartHeight;l.$el.css({top:s,height:h});l.height=h;this.append(l.$el);animateLayer(l,o);f.push(o+=i)}return f};App=window.WeddingApp={};App.Views={};App.Models={};App.Templates={};App.Routers={};App.Collections={};$(document).ready(function(){App.appView=new Backbone.View({el:"body"});return Backbone.history.start({pushState:true,hashChange:false})});App.Router=function(t){extend(e,t);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.routes={"":"home","/":"home",rsvp:"rsvp",story:"story",where:"where",registry:"registry"};e.prototype.home=function(){var t;return t=new App.Views.Home};e.prototype.rsvp=function(){var t;return t=new App.Views.Home(true)};e.prototype.where=function(){var t;return t=new App.Views.Where};return e}(Backbone.Router);App.router=new App.Router;App=window.WeddingApp;App.Models.Rsvp=function(t){extend(e,t);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.urlRoot="https://docs.google.com/forms/d/1gQH7_e0hBzf6bHLyXt04qCsdCmLB1FlhrXfusFXwUIM/formResponse";e.prototype.initialize=function(){return this.mapAndSet(_.extend(this.toJSON(),{domain:window.location.host}))};e.prototype.mappings={groupName:"entry.183949306",groupSize:"entry.1718135727",guestName:"entry.1671140108",guestAttendance:"entry.83143551",guestMeal:"entry.763928453",groupSong:"entry.2036395429",groupEmail:"entry.1033845525",domain:"entry.739322273",serializedForm:"entry.1547193837"};e.prototype.mapAndSet=function(t){var e,n,r,i;r={};for(e in t){i=t[e];n=this.mappings[e];r[n]=i}return this.set(r)};e.prototype.save=function(){var t,e,n,r,i,o,s;r=$.Deferred();e=$("<iframe></iframe>");e.addClass("hidden");e.attr({id:this.cid,name:this.cid});$("body").append(e);t=$("<form></form>");t.attr({action:this.urlRoot,method:"POST",target:this.cid});o=this.toJSON();for(i in o){s=o[i];n=$("<input></input>");n.attr({type:"hidden",value:s,name:i});t.append(n)}$("body").append(t);e.on("load",function(){return r.resolve()});t.submit();t.remove();return r};return e}(Backbone.Model);App.Views.Home=function(t){extend(e,t);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.el="#index-page";e.prototype.events={"click #rsvp":"rsvp","click .blanket":"close"};e.prototype.initialize=function(t){if(t==null){t=false}this.rsvpModal=new App.Views.RsvpModal;this.listenTo(this.rsvpModal,"close",function(){return this.close()});this.$blanket=this.$(".blanket");if(t){this.disableScroll();return this.rsvpModal.$("input").first().focus()}};e.prototype.rsvp=function(t){t.preventDefault();return this.showRsvp()};e.prototype.showRsvp=function(){this.$blanket.fadeIn(function(t){return function(){t.$blanket.animateHearts(3,2e3,2,40,300);return setTimeout(function(){return t.rsvpModal.slideUp(t.$blanket,1e3)},600)}}(this));return this.disableScroll()};e.prototype.close=function(){this.$blanket.fadeOut();return this.enableScroll()};e.prototype.enableScroll=function(){return $("body").removeClass("no-scroll")};e.prototype.disableScroll=function(){return $("body").addClass("no-scroll")};return e}(Backbone.View);App.Views.HeartBox=Backbone.View.extend({el:".modal-outer",initialize:function(){this.$heartBox=this.$(".heart-box");this.draw=SVG(this.$heartBox[0]);this.$formInner=this.$(".modal-inner");this.group=this.draw.group();this.poly=this.group.polygon().fill({color:"#F00"});this.leftCircle=this.group.circle().fill({color:"#F00"});return this.rightCircle=this.group.circle().fill({color:"#F00"})},maxWidth:function(){return this.$el.width()},formWidth:function(){return this.$formInner.width()},maxHeight:function(){return this.$el.height()},formHeight:function(){return this.$formInner.height()},render:function(){return this.drawHeart()},drawHeart:function(t){var e,n,r,i,o,s,a,u,p,l,h,c,d,f,m,g,y,v,$;if(t==null){t=1/5}r=this.formWidth();p=this.maxWidth();i=r+300;c=.9;g=i/4;i=g+g*2*c+g;if(i>p){i=p}this.draw.size(i,this.maxHeight());d=Math.PI;o=t*d;this.leftCircle.x(g).y(g).radius(g);this.rightCircle.x(g+g*2*c).y(g).radius(g);f=[];s=d+o;a=Math.cos(s)*g+g;u=Math.sin(s)*g*-1+g;f.push([a,u]);l=g*2*c;h=g;f.push([l,h]);y=2*d-o;v=Math.cos(y)*g+g+g*2*c;$=Math.sin(y)*g*-1+g;f.push([v,$]);e=g*2*c;n=g*2*2;f.push([e,n]);m=f.map(function(t){return t.join(",")}).join(" ");return this.poly.plot(m)}});personSection=_.template('<div class="guest-group">\n    <h3>Guest #<%= num %></h3>\n    <div class="form-group form-group-lg has-feedback">\n        <label for="person-name-<%= num %>">Guest Name</label>\n        <input type="text" class="form-control person-name" id="person-name-<%= num %>" required="required" minlength=1 name="guestName-<%= num %>">\n        <span class="glyphicon glyphicon-ok form-control-feedback"> </span> \n        <span class="glyphicon glyphicon-remove form-control-feedback"> </span> \n    </div>\n    <div class="form-group attendance-group">\n        <div class="radio input-lg">\n            <label>\n                <input type="radio" class="attendance attendance-yes" name="guestAttendance-<%= num %>" value="yes" required="required">\n                <span>Will be attending</span>\n            </label>\n        </div>\n        <div class="radio input-lg">\n            <label>\n                <input type="radio" class="attendance attendance-no" name="guestAttendance-<%= num %>" value="no" required="required">\n                <span>Will not be attending</span>\n            </label>\n        </div>\n        <div class="form-group form-group-lg meal-group">\n            <label for="entree-<%= num %>">Entree</label>\n            <select id="entree-<%= num %>" name="guestMeal-<%= num %>" class="form-control">\n                <option value="beef">Beef short rib</option>\n                <option value="chicken">Chicken piccata</option>\n                <option value="veggie">Vegetarian</option>\n            </select>\n        </div>\n    </div>\n</div>');App.Views.RsvpModal=function(t){extend(e,t);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.el="#rsvp-modal";e.prototype.events={"click .close":"fadeOut",click:"outerClick","click .modal-dialog":"innerClick","click #update-guest":"updateGuests","input .person-name":"updateName","change .attendance":"handleAttendance","submit .rsvp-form":"handleSubmit"};e.prototype.clickedInside=false;e.prototype.showingGuests=false;e.prototype.saving=false;e.prototype.initialize=function(){var t;window.modal=this;this.$guestSection=this.$(".guest-section");this.$form=this.$(".rsvp-form");t=this;return this.$form.validate({errorPlacement:function(){},submitHandler:function(t){return function(e){return t.ajaxSubmit()}}(this),showErrors:function(e,n){this.defaultShowErrors();t.floatErrors();return t.enableIfReady(n)}})};e.prototype.floatErrors=function(){var t;t=this.$(".form-group");t.removeClass("has-success").removeClass("has-error");t.has(".error").addClass("has-error");return t.has(".valid").addClass("has-success")};e.prototype.enableIfReady=function(t){if(this.showingGuests&&t.length===0){return this.$("#rsvp-submit").removeAttr("disabled")}else{return this.$("#rsvp-submit").attr("disabled","disabled")}};e.prototype.show=function(){this.$el.show();return this.afterShow()};e.prototype.hide=function(){this.$el.hide();return this.afterClose()};e.prototype.afterShow=function(){return mixpanel.track("RSVP show")};e.prototype.afterClose=function(){this.saving=false;return this.trigger("close")};e.prototype.slideUp=function(t,e){if(e==null){e=1e3}this.$(".success-message").hide();this.$(".saving-message").hide();this.$(".rsvp-form").show();this.$el.css({top:t.height()}).show().animate({top:0},{duration:e,complete:function(t){return function(){return t.$("input").first().focus()}}(this)});return this.afterShow()};e.prototype.fadeOut=function(){this.$el.fadeOut();return this.afterClose()};e.prototype.innerClick=function(){return this.clickedInside=true};e.prototype.outerClick=function(){if(!this.clickedInside){this.fadeOut()}this.clickedInside=false;return true};e.prototype.handleAttendance=function(t){var e,n;n=$(t.target);e=n.parentsUntil(".guest-section").last();if(e.find(".attendance-no").prop("checked")){return e.find(".meal-group").slideUp()}else{return e.find(".meal-group").slideDown()}};e.prototype.handleSubmit=function(t){return t.preventDefault()};e.prototype.ajaxSubmit=function(t){var e,n,r,i,o,s,a,u,p,l,h,c,d,f,m,g,y;r=this.$form.serializeArray();e={};i={};s={};f=[];for(u=0,h=r.length;u<h;u++){a=r[u];p=a.name;y=a.value;e[p]=y;l=p.split("-");m=l[0];g=l[1];if(g){s[g]||(s[g]={});s[g][m]=y}else{i[p]=y}}mixpanel.track("RSVP Submit",e);if(typeof JSON!=="undefined"&&JSON!==null&&JSON.stringify!=null){i.serializedForm=JSON.stringify(e)}else{i.serializedForm=this.$form.serialize()}n=function(){var t;t=[];for(g in s){o=s[g];d=new App.Models.Rsvp;d.mapAndSet(_.extend(o,i));t.push(d.save())}return t}();c=$.Deferred();window.setTimeout(function(){return c.resolve()},2e3);n.push(c);$.when.apply($,n).done(function(t){return function(){return t.showSuccess()}}(this));this.showSaving();return this.animateSaving()};e.prototype.updateGuests=function(){var t,e,n,r,i,o,s;this.$guestSection.css({opacity:0,display:"none"});r=Number(this.$el.find("#party-size").val());if(r===NaN||r<1){return}e="";s=1;for(t=n=i=s,o=r;i<=o?n<=o:n>=o;t=i<=o?++n:--n){e+=personSection({num:t})}return this.$guestSection.html(e).slideDown(1e3).animate({opacity:1},{complete:function(t){return function(){t.showingGuests=true;return t.$(".modal-content").animate({scrollTop:t.$guestSection.position().top+"px"})}}(this)})};e.prototype.updateName=function(t){var e,n,r;n=$(t.target);e=n.parentsUntil(".guest-section").last();r=n.val();return e.find("h3").text(r)};e.prototype.animateSaving=function(){var t,e;t=this.$(".save-heart");e=-1;return this.savingInterval=window.setInterval(function(n){return function(){if(e>=0){$(t[e]).removeClass("active")}e+=1;if(e>t.length-1){e=0}$(t[e]).addClass("active");if(!n.saving){return window.clearInterval(n.savingInterval)}}}(this),250)};e.prototype.showSaving=function(){this.$form.slideUp();this.$(".saving-message").show();this.saving=true;return this.animateSaving()};e.prototype.showSuccess=function(){this.$form.slideUp();this.saving=false;this.$(".saving-message").hide();return this.$(".success-message").show()};return e}(Backbone.View);App.Views.StoryHeader=function(t){extend(e,t);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.el="#story-page .top-part";e.prototype.backgroundImages=["/images/shadow_1_wide.jpg"];e.prototype.height=300;e.prototype.initialize=function(){return this.$layers=this.$(".heart-bg")};e.prototype.changeBG=function(){var t;t=this.backgroundImages.pop();return this.$el.css({"background-image":"url("+t+")"})};e.prototype.animateHearts=function(){var t,e,n,r,i,o,s,a;if(this.animating){return}this.animating=true;n=0;e=this.$layers.length;s=this.$layers;a=[];for(r=0,o=s.length;r<o;r++){i=s[r];t=$(i);this.animateLayer(t,n);a.push(n+=300)}return a};e.prototype.animateLayer=function(t,e){var n,r;r=this.height+100;n=2e3-e;return setTimeout(function(e){return function(){return t.animate({top:"-"+r+"%"},{duration:n,easing:"linear",complete:function(){var n;t.css({top:"100%"});if(n=length-1){return e.animating=false}}})}}(this),e)};return e}(Backbone.View);App.Views.Where=function(t){extend(e,t);function e(){return e.__super__.constructor.apply(this,arguments)}e.prototype.el="#where-page";e.prototype.apiKey="AIzaSyA4kjM9Ys7Yott7dO_ESqewl04gppkUlm8";e.prototype.mode="driving";e.prototype.events={"change .direction-choices":"directionChange","click .direction-mode button":"modeChange"};e.prototype.initialize=function(){this.$from=this.$("#from-picker");this.$to=this.$("#to-picker");this.$iframe=this.$("#map-embed");this.$link=this.$("#map-link");this.$modeButtons=this.$(".direction-mode .btn");this.$("button[data-mode='"+this.mode+"']").addClass("active");this.$to.find("option[value='Garden+Court+Hotel,+Cowper+Street,+Palo+Alto,+CA,+United+States']").attr("selected",true);return this.$from.find("option[value='Church+of+the+Nativity,+Oak+Grove+Avenue,+Menlo+Park,+CA,+United+States']").attr("selected",true)};e.prototype.modeChange=function(t){var e;e=$(t.target);this.$modeButtons.removeClass("active");e.addClass("active");if(this.mode!==e.data("mode")){this.mode=e.data("mode");return this.directionChange()}};e.prototype.directionChange=function(){this.$iframe.attr("src",this.embedUrl());return this.$link.attr("href",this.linkUrl())};e.prototype.getDirections=function(){return{origin:this.$from.val(),destination:this.$to.val()}};e.prototype.embedUrl=function(){var t;t=$.extend(this.getDirections(),{mode:this.mode,key:this.apiKey});return"https://www.google.com/maps/embed/v1/directions?"+this.paramString(t)};e.prototype.linkUrl=function(){var t;t=this.getDirections();return"https://www.google.com/maps/dir/"+t.origin+"/"+t.destination};e.prototype.paramString=function(t){var e,n,r;n=function(){var n;n=[];for(e in t){r=t[e];n.push(e+"="+r)}return n}();return n.join("&")};return e}(Backbone.View);